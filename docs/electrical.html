<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WALL-E: Electrical Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="WALL-E_Logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">WALL-E<span id="projectnumber">&#160;Version 1.0</span>
   </div>
   <div id="projectbrief">The &quot;WALL-E&quot; Project is a ME 507 quarter term project inspired to recreate the robot WALL-E. The WALL-E robot is a fully 3D printed robot with modified components in order to fit the needs of the chosen peripherals and electronics. WALL-E contains a custom made PCB which is housed in the main body of WALL-E. WALL-E&#39;s peripherals and components include 2 pololu Romi Motors with encoders, 4 MG90s servos, BNO055 IMU, and a OV2640 ArduCam camera. The objective of WALL-E is to scan the surrounding area for the closest object to it. Once that object is detected, WALL-E drives up to the object, attempts to pick up or hold the object and detect the color of the object.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('electrical.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Electrical Design </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1 class="doxsection"><a class="anchor" id="autotoc_md15"></a>
Overview</h1>
<p>This page will explain the Electrical Design aspects of the WALL-E project from PCB design to pinout setup.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md16"></a>
WALL-E Pinout Table</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">#  </th><th class="markdownTableHeadNone">Device  </th><th class="markdownTableHeadNone">STM Pin  </th><th class="markdownTableHeadNone">Function  </th><th class="markdownTableHeadNone">Device Pin  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">Right Motor  </td><td class="markdownTableBodyNone">PA15  </td><td class="markdownTableBodyNone">Digital Output  </td><td class="markdownTableBodyNone">EN_right  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PB1  </td><td class="markdownTableBodyNone">TIM3_CH4 (AF2)  </td><td class="markdownTableBodyNone">DIR_right  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PB7  </td><td class="markdownTableBodyNone">Digital Output  </td><td class="markdownTableBodyNone">SL_right  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PB7  </td><td class="markdownTableBodyNone">TIM4_CH2  </td><td class="markdownTableBodyNone">ENCA_right  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PB8  </td><td class="markdownTableBodyNone">TIM4_CH3  </td><td class="markdownTableBodyNone">ENCB_right  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">6  </td><td class="markdownTableBodyNone">Left Motor  </td><td class="markdownTableBodyNone">PC4  </td><td class="markdownTableBodyNone">Digital Output  </td><td class="markdownTableBodyNone">EN_left  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">7  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PB0  </td><td class="markdownTableBodyNone">TIM3_CH3 (AF2)  </td><td class="markdownTableBodyNone">DIR_left  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">8  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PC5  </td><td class="markdownTableBodyNone">Digital Output  </td><td class="markdownTableBodyNone">SL_left  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PA0_WKUP  </td><td class="markdownTableBodyNone">TIM2_CH1  </td><td class="markdownTableBodyNone">ENCA_left  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PB10  </td><td class="markdownTableBodyNone">TIM2_CH2  </td><td class="markdownTableBodyNone">ENCB_left  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">11  </td><td class="markdownTableBodyNone">Left Arm <a class="el" href="class_servo.html" title="WALL-E servo motors class developed for hands and arm movements.">Servo</a>  </td><td class="markdownTableBodyNone">PA8  </td><td class="markdownTableBodyNone">TIM1_CH1 (AF1)  </td><td class="markdownTableBodyNone">L_ArmPWM  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">12  </td><td class="markdownTableBodyNone">Left Hand <a class="el" href="class_servo.html" title="WALL-E servo motors class developed for hands and arm movements.">Servo</a>  </td><td class="markdownTableBodyNone">PA9  </td><td class="markdownTableBodyNone">TIM1_CH2 (AF1)  </td><td class="markdownTableBodyNone">L_Hand_PWM  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">13  </td><td class="markdownTableBodyNone">Right Hand <a class="el" href="class_servo.html" title="WALL-E servo motors class developed for hands and arm movements.">Servo</a>  </td><td class="markdownTableBodyNone">PA10  </td><td class="markdownTableBodyNone">TIM1_CH3 (AF1)  </td><td class="markdownTableBodyNone">R_Hand_PWM  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">14  </td><td class="markdownTableBodyNone">Right Arm <a class="el" href="class_servo.html" title="WALL-E servo motors class developed for hands and arm movements.">Servo</a>  </td><td class="markdownTableBodyNone">PA11  </td><td class="markdownTableBodyNone">TIM1_CH4 (AF1)  </td><td class="markdownTableBodyNone">R_Arm_PWM  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">15  </td><td class="markdownTableBodyNone">Camera  </td><td class="markdownTableBodyNone">PB9  </td><td class="markdownTableBodyNone">I2C1_SCL(AF4)  </td><td class="markdownTableBodyNone">I2C_SCL  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">16  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PB6  </td><td class="markdownTableBodyNone">I2C1_SCL(AF4)  </td><td class="markdownTableBodyNone">I2C_SCL  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">17  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PC12  </td><td class="markdownTableBodyNone">Digital Output  </td><td class="markdownTableBodyNone">CAM_CS  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">18  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PA5  </td><td class="markdownTableBodyNone">SPI1_SCK (AF5)  </td><td class="markdownTableBodyNone">CAM_SCLK  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">19  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PA7  </td><td class="markdownTableBodyNone">SPI1_MOSI(AF5)  </td><td class="markdownTableBodyNone">CAM_MOSI  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">20  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PB4  </td><td class="markdownTableBodyNone">SPI1_MISO(AF5)  </td><td class="markdownTableBodyNone">CAM_MISO  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">21  </td><td class="markdownTableBodyNone">Range Finder  </td><td class="markdownTableBodyNone">PB5  </td><td class="markdownTableBodyNone">TIM3_CH2 (AF2)  </td><td class="markdownTableBodyNone">Echo  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">22  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PA6  </td><td class="markdownTableBodyNone">Digital Output  </td><td class="markdownTableBodyNone">Trig  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">23  </td><td class="markdownTableBodyNone">IMU (<a class="el" href="class_b_n_o055.html" title="BNO055 class for the IMU containing modes of operation, initialization, and reading data.">BNO055</a>)  </td><td class="markdownTableBodyNone">PB6  </td><td class="markdownTableBodyNone">I2C1_SCL(AF4)  </td><td class="markdownTableBodyNone">I2C_SCL  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">24  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PB9  </td><td class="markdownTableBodyNone">I2C1_SDA(AF4)  </td><td class="markdownTableBodyNone">I2C_SDA  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">25  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PA4  </td><td class="markdownTableBodyNone">Digital Output  </td><td class="markdownTableBodyNone">IMU_NRST  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">26  </td><td class="markdownTableBodyNone">Battery  </td><td class="markdownTableBodyNone">PA1  </td><td class="markdownTableBodyNone">ADC  </td><td class="markdownTableBodyNone">Bat_ADC  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">27  </td><td class="markdownTableBodyNone">LED  </td><td class="markdownTableBodyNone">PC13  </td><td class="markdownTableBodyNone">Digital Output (active low)  </td><td class="markdownTableBodyNone">N/A  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">28  </td><td class="markdownTableBodyNone">STLink  </td><td class="markdownTableBodyNone">PA13  </td><td class="markdownTableBodyNone">SYS Trace Async SW  </td><td class="markdownTableBodyNone">ST_SWDIO  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">29  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PA14  </td><td class="markdownTableBodyNone">SYS Trace Async SW  </td><td class="markdownTableBodyNone">ST_SWCLK  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">30  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">NRST  </td><td class="markdownTableBodyNone">SYS Trace Async SW  </td><td class="markdownTableBodyNone">NRST  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">31  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">PB3  </td><td class="markdownTableBodyNone">SYS Trace Async SW  </td><td class="markdownTableBodyNone">ST_SWO  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">32  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">A3  </td><td class="markdownTableBodyNone">USART2_RX  </td><td class="markdownTableBodyNone">ST_TX  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">33  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">A2  </td><td class="markdownTableBodyNone">USART2_TX  </td><td class="markdownTableBodyNone">ST_RX  </td></tr>
</table>
<h2 class="doxsection"><a class="anchor" id="autotoc_md17"></a>
PCB Design</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md18"></a>
Main Board Schematic</h3>
<p><img src="MotherboardSchem.png" alt="" class="inline" title="Motherboard Schematic"/>    </p>
<p>The main board for this project was designed around an STM32F411 microcontroller. The 48 pin version of this chip was needed because of how many sensors and actuators the total design required. To power the MCU as well as all of the other peripherals, a power regulation and distribution section was designed. </p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md19"></a>
Power Regulation</h3>
<p><img src="PowerDistr.png" alt="" class="inline" title="Power Regulation"/>    </p>
<p>The power regulation section first starts with the battery. A 3 cell LiPo battery was chosen for this project since its nominal voltage is near 12V. To protect the battery, a 5A fuse is placed in series with it. This current measurement was calculated based on the maximum powers and voltages of all the other components on the board plus a margin. This ensures that the fuse won’t blow under normal circumstances, only in the event of an emergency. A high resistance voltage divider is also placed on the battery voltage node so that the MCU can read the battery voltage and warn the user when the battery is getting low. Next, there is an on switch and an emergency stop button, both of which cut power to the entire system. After that is a reverse polarity protection MOSFET. Even though the power input connector (XT30) is polarized and cannot be physically plugged in backwards, this MOSFET is a backup to make sure that the board will never experience reverse voltage which would damage many components on the board. The power regulation continues with a buck converter which steps the 11.1V from the battery down to 5V. We chose to use a buck here for maximum efficiency since stepping the fully battery voltage down with an LDO would waste a lot of power. This choice ensures that Wall-E can last much longer on a single charge. 5V was also intentionally chosen as the step down voltage because it is needed to power multiple components on the board. Finally, an LDO is used to step 5V down to the 3.3V used by many other systems. An LDO makes more sense here since the voltage drop isn’t as large and the output on the 3.3V rail will be smoother which is nice for the microcontroller. Other than the power section and MCU section, the other main sections of the board are the IMU and the motor drivers. The IMU section is designed to mimic the <a class="el" href="class_b_n_o055.html" title="BNO055 class for the IMU containing modes of operation, initialization, and reading data.">BNO055</a> breakout board from Adafruit. Building it into the motherboard means that it is one less connector to worry about and all angles and accelerations will be physically tied to the motherboard. Unfortunately due to the current tariffs between the US and China, it was unviable to place this component on the board in the end. However, all the surrounding circuitry is still there if we ever want to solder one on ourselves in the future. The motors drivers are simple h-bridge motor drivers. They take 2 pwm signals in and then switch the motor leads between high and low depending on the PWM signals. This allows us to control the higher voltage and high current draw of the motors with the lower voltage and lower current output of the microcontroller. Since many of our peripherals could not be placed directly on the board, there were many pinheader connectors leading off from the microcontroller. These pin headers proved to be challenging to work with when actually building the robot because they had a tendency to fall out easily. In the future, I would redesign these to use locking connectors like JST. Besides the major components, decoupling capacitors were placed on all the power pins of all chips on the board. This is especially necessary for the motor drivers since they need a quick source of charge for current spikes when switching. </p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md20"></a>
PCB Layout</h3>
<p><img src="PCBLayout.png" alt="" class="inline" title="PCB Layout for the WALL-E Motherboard"/>    </p>
<p>The main considerations when laying out this motherboard were signal and power integrity as well as ease of use. The entire power section was laid out first to keep the noise of the switching regulator isolated to that section of the board. Larger traces were used when routing the power for the motors since they draw the most current on the board. An online PCB trace width calculator was used to verify that the traces were wide enough so that they would only heat up 50 degrees C when under max load. The board uses 4 layers: the top layer is the majority of the signals, the middle two layers are ground and 3.3V with one cutout in each to route thick 5V traces. And the bottom layer is used for only necessary signals and 12V power. The MCU was placed on a diagonal to ease routing and pins were chosen so that the peripherals would lay on the correct side of the chip when possible. Three indicator lights were placed together. The first lights up when the battery 12V reaches the board. The second lights up off the 3.3V rail implying that the whole power section is working correctly. Finally the third LED is connected to the MCU to be used for debugging and user feedback. The reset button was placed on the edge of the board for easy access. Test points were added to the inaccessible MCU lines like the motor controller PWM signals and buck switch node. Mounting holes were placed asymmetrically so the motherboard can’t be placed backwards accidentally. All headers were roughly placed on the side of the board that they needed to be accessed from in the final design. All decoupling capacitors were placed as physically close to the pins they are decoupling as possible. All traces were routed carefully with as few layer hops as possible. Finally, all components were placed close together but not too close where rework was impossible. In the end, we ended up having to rework 2 resistors which ended up being super easy because we used 0603 sized components and made sure there was enough space for a soldering iron on either side of every component on the board. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
